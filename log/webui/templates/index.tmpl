<!DOCTYPE html>
<html>

<head>
    <title>Log Package Levels</title>
    <style>
        /* --- Background --- */
        .dashboard-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #6b46c1, #d53f8c);
            z-index: -1;
        }

        /* --- Main container --- */
        .main-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: "Inter", system-ui, sans-serif;
            color: #fff;
            padding: 20px;
        }

        /* --- Topbar --- */
        .topbar {
            padding: 16px 24px;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 24px;
            font-size: 1.3rem;
            font-weight: 600;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        }

        /* --- Content area --- */
        .content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* --- Card --- */
        .card {
            width: 100%;
            max-width: 1000px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
        }

        .card h2 {
            margin-top: 0;
            margin-bottom: 16px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        /* --- Table --- */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 12px;
            border-radius: 12px;
            /* optional: rounds overall table/card corners */
            overflow: hidden;
            /* ensures no individual cell rounding shows */
        }

        thead th {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 0;
            /* remove pill shape */
            padding: 12px 16px;
        }

        tbody tr {
            background: rgba(255, 255, 255, 0.05);
            transition: background 0.2s;
            border-radius: 0;
            /* rows can stay rectangular, spacing still applied */
        }

        tbody td {
            border-radius: 0;
            /* optional: ensure cells are rectangular */
        }

        tbody tr:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        /* --- Buttons --- */
        td button {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: #fff;
            padding: 6px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s, transform 0.1s;
        }

        td button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }

        /* --- Selects --- */
        td select {
            padding: 6px 10px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-weight: 500;
            cursor: pointer;
        }

        td select:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>
    <div class="dashboard-bg"></div>

    <div class="main-container">
        <header class="topbar">
            <h1>Cloudberry Logs</h1>
        </header>

        <main class="content">
            <div class="card">
                <h2>Registered Packages</h2>
                <table id="pkgTable">
                    <thead>
                        <tr>
                            <th>Package</th>
                            <th>Level</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="pkgTableBody">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        async function loadLevels() {
            const res = await fetch("/log/level/all");
            return await res.json();
        }

        async function loadPackages() {
            const res = await fetch("/log/level/package/all");
            return await res.json();
        }

        async function render() {
            const levels = await loadLevels();
            const pkgs = await loadPackages();

            const tbody = document.getElementById("pkgTableBody");
            tbody.innerHTML = "";

            pkgs.forEach(pkg => {
                const tr = document.createElement("tr");

                // Package column
                const tdName = document.createElement("td");
                tdName.textContent = pkg.name;

                // Level dropdown
                const tdLevel = document.createElement("td");
                const select = document.createElement("select");

                for (const lvl in levels) {
                    const opt = document.createElement("option");
                    opt.value = lvl;
                    opt.textContent = levels[lvl];
                    if (parseInt(lvl) === pkg.level) opt.selected = true;
                    select.appendChild(opt);
                }

                tdLevel.appendChild(select);

                // Save button
                const tdAction = document.createElement("td");
                const button = document.createElement("button");
                button.textContent = "Save";

                button.onclick = async () => {
                    const params = new URLSearchParams();
                    params.append("pkg", pkg.name);
                    params.append("level", select.value);

                    await fetch("/log/level/package/update", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: params.toString()
                    });

                    await render();
                };

                tdAction.appendChild(button);

                // Assemble row
                tr.appendChild(tdName);
                tr.appendChild(tdLevel);
                tr.appendChild(tdAction);

                tbody.appendChild(tr);
            });
        }

        render();
    </script>
</body>



</html>